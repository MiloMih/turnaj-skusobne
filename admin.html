<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin – Úprava tímov</title>

  <!-- Firebase import -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js"></script>

  <script>
  // Firebase konfigurácia
  const firebaseConfig = {
    apiKey: "AIzaSyDNWRlWmBtQPIR49KViBpWf16hDUjU7Npw",
    authDomain: "turnaj-skusobne.firebaseapp.com",
    projectId: "turnaj-skusobne",
    storageBucket: "turnaj-skusobne.firebasestorage.app",
    messagingSenderId: "755998492681",
    appId: "1:755998492681:web:f3242ae0f54b61903290d8",
    measurementId: "G-B8DVMX2KVV"
  };

  // Inicializuj Firebase a Firestore
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Referencia na kolekciu "teams"
  const teamsRef = db.collection("teams");

  // Funkcia na kontrolu, či je používateľ prihlásený
  function checkLogin() {
    const username = localStorage.getItem("username");
    const loginButton = document.getElementById("loginButton");

    if (username) {
      loginButton.textContent = 'Odhlásiť sa';
      loginButton.onclick = logout;
      // Zobraziť sekciu pre editáciu tímov
      document.getElementById("editableTeams").classList.remove("hidden");
      document.getElementById("usernameDisplay").textContent = username;
      document.getElementById("viewTeams").classList.add("hidden"); // Skrytí čítanie tímov pre prihláseného
    } else {
      loginButton.textContent = 'Prihlásiť sa';
      loginButton.onclick = login;
      // Zobraziť iba čítacie údaje (pre neprihlásených)
      document.getElementById("viewTeams").classList.remove("hidden");
      document.getElementById("editableTeams").classList.add("hidden"); // Skrytí sekcie pre editáciu tímov
    }
  }

  // Funkcia na prihlásenie
  function login() {
    window.location.href = 'login.html'; // Presmerovanie na prihlasovaciu stránku
  }

  // Funkcia na odhlásenie
  function logout() {
    localStorage.removeItem("username");
    location.reload(); // Prečítanie stránky a skrytí editácie
  }

  // Funkcia na ukladanie tímov do Firestore (len pre prihláseného používateľa)
  async function saveTeams() {
    const teams = {
      groupA: [
        document.getElementById("teamA1").value,
        document.getElementById("teamA2").value,
        document.getElementById("teamA3").value,
        document.getElementById("teamA4").value,
        document.getElementById("teamA5").value
      ]
    };

    try {
      // Ukladáme tímové údaje do Firestore
      await teamsRef.doc("u12ch").set(teams);
      console.log("Tímy uložené do Firestore:", teams);

      // Po úspešnom uložení, aktualizujeme zobrazenie
      displayTeams();
    } catch (err) {
      console.error("Chyba pri ukladaní do Firestore:", err);
      alert("Nastala chyba pri ukladaní tímov.");
    }
  }

  // Funkcia na zobrazenie tímov (pre všetkých)
  async function displayTeams() {
    try {
      // Načítame tímové údaje z Firestore
      const doc = await teamsRef.doc("u12ch").get();
      if (doc.exists) {
        const teams = doc.data().groupA;
        document.getElementById("teamA1Display").innerText = teams[0] || "";
        document.getElementById("teamA2Display").innerText = teams[1] || "";
        document.getElementById("teamA3Display").innerText = teams[2] || "";
        document.getElementById("teamA4Display").innerText = teams[3] || "";
        document.getElementById("teamA5Display").innerText = teams[4] || "";
      }
    } catch (err) {
      console.error("Chyba pri načítaní tímov z Firestore:", err);
    }
  }

  // Funkcia volaná pri načítaní stránky
  window.onload = function() {
    const username = localStorage.getItem("username");

    // Ak používateľ nie je prihlásený, presmerujeme ho na login stránku
    if (!username) {
      window.location.href = "login.html";
    } else {
      checkLogin(); // Skontroluje prihlásenie
      displayTeams(); // Načíta a zobrazí tímov aj pre neprihlásených
    }
  };
</script>
</head>
<body>
  <!-- Hlavička pre prihlásenie/odhlásenie -->
  <div id="header-container">
    <button id="loginButton">Prihlásiť sa</button>
  </div>

  <!-- Zobrazenie prihláseného používateľa -->
  <div id="userPanel" class="hidden">
    <p>Prihlásený ako: <span id="usernameDisplay"></span></p>
  </div>

  <!-- Úprava tímov (len pre prihlásených) -->
  <div id="editableTeams" class="hidden">
    <h2>Úprava tímov – Skupina A</h2>
    <input type="text" id="teamA1" placeholder="Tím 1" />
    <input type="text" id="teamA2" placeholder="Tím 2" />
    <input type="text" id="teamA3" placeholder="Tím 3" />
    <input type="text" id="teamA4" placeholder="Tím 4" />
    <input type="text" id="teamA5" placeholder="Tím 5" />
    <button onclick="saveTeams()">Uložiť tímy</button>
  </div>

  <!-- Zobrazenie tímov (pre všetkých) -->
  <div id="viewTeams">
    <h2>Skupina A – Tímy</h2>
    <ul class="team-list">
      <li id="teamA1Display"></li>
      <li id="teamA2Display"></li>
      <li id="teamA3Display"></li>
      <li id="teamA4Display"></li>
      <li id="teamA5Display"></li>
    </ul>
  </div>
</body>
</html>
